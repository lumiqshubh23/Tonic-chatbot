{"ast":null,"code":"var _jsxFileName = \"/home/shubham/Documents/Personal/my-project/react-app/src/components/ChatInterface.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect } from 'react';\nimport FileUpload from './FileUpload';\nimport ChatMessage from './ChatMessage';\nimport { Send, Download, BarChart3 } from 'lucide-react';\nimport styled from 'styled-components';\nimport toast from 'react-hot-toast';\nimport { fileAPI, chatAPI } from '../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ChatContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: calc(100vh - 140px);\n  max-width: 1200px;\n  margin: 0 auto;\n`;\n_c = ChatContainer;\nconst FileUploadSection = styled.div`\n  margin-bottom: 20px;\n  background: white;\n  border-radius: 12px;\n  padding: 20px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n  border: 1px solid #e2e8f0;\n`;\n_c2 = FileUploadSection;\nconst ChatSection = styled.div`\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  overflow: hidden;\n  border: 1px solid #e2e8f0;\n`;\n_c3 = ChatSection;\nconst ChatHeader = styled.div`\n  padding: 20px;\n  border-bottom: 1px solid #e2e8f0;\n  background: #f8f9fa;\n`;\n_c4 = ChatHeader;\nconst ChatTitle = styled.h3`\n  color: #2d3748;\n  margin: 0;\n  font-size: 1.2rem;\n  font-weight: 600;\n`;\n_c5 = ChatTitle;\nconst MessagesContainer = styled.div`\n  flex: 1;\n  overflow-y: auto;\n  padding: 20px;\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n  background: #f7fafc;\n`;\n_c6 = MessagesContainer;\nconst InputSection = styled.div`\n  padding: 20px;\n  border-top: 1px solid #e2e8f0;\n  background: #f8f9fa;\n`;\n_c7 = InputSection;\nconst InputForm = styled.form`\n  display: flex;\n  gap: 12px;\n  align-items: flex-end;\n`;\n_c8 = InputForm;\nconst TextArea = styled.textarea`\n  flex: 1;\n  padding: 16px;\n  border: 1px solid #e2e8f0;\n  border-radius: 12px;\n  font-size: 16px;\n  font-family: inherit;\n  resize: vertical;\n  min-height: 60px;\n  max-height: 200px;\n  background: white;\n  transition: all 0.2s ease;\n  \n  &:focus {\n    outline: none;\n    border-color: #FF6B35;\n    box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);\n  }\n  \n  &::placeholder {\n    color: #a0aec0;\n  }\n`;\n_c9 = TextArea;\nconst SendButton = styled.button`\n  padding: 16px 24px;\n  background: linear-gradient(135deg, #FF6B35 0%, #e53e3e 100%);\n  color: white;\n  border: none;\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-weight: 600;\n  font-size: 14px;\n  \n  &:hover {\n    transform: translateY(-1px);\n    box-shadow: 0 10px 25px rgba(255, 107, 53, 0.3);\n  }\n  \n  &:disabled {\n    opacity: 0.6;\n    cursor: not-allowed;\n    transform: none;\n  }\n`;\n_c0 = SendButton;\nconst ResponseSection = styled.div`\n  margin-top: 20px;\n  padding: 20px;\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  border: 1px solid #e2e8f0;\n`;\nconst ResponseHeader = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  margin-bottom: 15px;\n  color: #2d3748;\n  font-weight: 600;\n`;\n_c1 = ResponseHeader;\nconst PlotSection = styled.div`\n  margin-top: 20px;\n  padding: 20px;\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  border: 1px solid #e2e8f0;\n`;\n_c10 = PlotSection;\nconst TableSection = styled.div`\n  margin-top: 20px;\n`;\n_c11 = TableSection;\nconst TableContainer = styled.div`\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  overflow: hidden;\n  margin-bottom: 15px;\n  border: 1px solid #e2e8f0;\n`;\n_c12 = TableContainer;\nconst TableHeader = styled.div`\n  padding: 16px 20px;\n  background: #f8f9fa;\n  border-bottom: 1px solid #e2e8f0;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n`;\n_c13 = TableHeader;\nconst TableTitle = styled.h4`\n  color: #2d3748;\n  margin: 0;\n  font-weight: 600;\n`;\n_c14 = TableTitle;\nconst DownloadButton = styled.button`\n  padding: 8px 16px;\n  background: #FF6B35;\n  color: white;\n  border: none;\n  border-radius: 8px;\n  cursor: pointer;\n  font-size: 0.9rem;\n  display: flex;\n  align-items: center;\n  gap: 5px;\n  font-weight: 500;\n  transition: all 0.2s ease;\n  \n  &:hover {\n    background: #e53e3e;\n    transform: translateY(-1px);\n  }\n`;\n_c15 = DownloadButton;\nconst Table = styled.table`\n  width: 100%;\n  border-collapse: collapse;\n`;\n_c16 = Table;\nconst Th = styled.th`\n  padding: 12px 16px;\n  text-align: left;\n  background: #f8f9fa;\n  border-bottom: 1px solid #e2e8f0;\n  font-weight: 600;\n  color: #2d3748;\n`;\n_c17 = Th;\nconst Td = styled.td`\n  padding: 12px 16px;\n  border-bottom: 1px solid #e2e8f0;\n  color: #4a5568;\n`;\n_c18 = Td;\nconst EmptyState = styled.div`\n  text-align: center;\n  padding: 60px 20px;\n  color: #718096;\n  \n  h3 {\n    margin-bottom: 12px;\n    color: #4a5568;\n    font-weight: 600;\n  }\n  \n  p {\n    margin-bottom: 20px;\n    font-size: 16px;\n  }\n`;\n_c19 = EmptyState;\nconst LoadingContainer = styled.div`\n  text-align: center;\n  padding: 40px 20px;\n  color: #718096;\n  \n  .spinner {\n    margin: 0 auto 16px auto;\n  }\n  \n  p {\n    font-size: 16px;\n    margin: 0;\n  }\n`;\n_c20 = LoadingContainer;\nfunction ChatInterface({\n  currentSession,\n  sessions,\n  setSessions\n}) {\n  _s();\n  const [userInput, setUserInput] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [knowledgeBase, setKnowledgeBase] = useState('');\n  const [currentResponse, setCurrentResponse] = useState('');\n  const [currentPlot, setCurrentPlot] = useState(null);\n  const [currentTables, setCurrentTables] = useState([]);\n  const messagesEndRef = useRef(null);\n  const scrollToBottom = () => {\n    var _messagesEndRef$curre;\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  };\n  useEffect(() => {\n    scrollToBottom();\n  }, [sessions[currentSession]]);\n  const handleSubmit = async e => {\n    e.preventDefault();\n    if (!userInput.trim() || isLoading) return;\n    const question = userInput.trim();\n    setUserInput('');\n    setIsLoading(true);\n\n    // Add user message to session\n    const newMessage = {\n      q: question,\n      a: '',\n      timestamp: new Date().toLocaleString(),\n      type: 'user'\n    };\n    setSessions(prev => ({\n      ...prev,\n      [currentSession]: [...prev[currentSession], newMessage]\n    }));\n    try {\n      // Get AI response from backend\n      const response = await chatAPI.sendMessage(question, knowledgeBase, sessions[currentSession], currentSession);\n      if (response.success) {\n        // Add AI response to session\n        const aiMessage = {\n          q: question,\n          a: response.response,\n          timestamp: response.timestamp,\n          type: 'ai',\n          tables: response.tables || [],\n          plot: response.plot\n        };\n        setSessions(prev => ({\n          ...prev,\n          [currentSession]: prev[currentSession].map((msg, index) => index === prev[currentSession].length - 1 ? aiMessage : msg)\n        }));\n        setCurrentResponse(response.response);\n        setCurrentTables(response.tables || []);\n        setCurrentPlot(response.plot);\n      } else {\n        toast.error('Failed to get response from AI');\n      }\n    } catch (error) {\n      toast.error('Failed to get response. Please try again.');\n      console.error('Error:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  const handleFileUpload = async files => {\n    try {\n      const response = await fileAPI.upload(files);\n      if (response.success) {\n        setKnowledgeBase(response.knowledge_base);\n        toast.success(response.message);\n      } else {\n        toast.error('Failed to process files');\n      }\n    } catch (error) {\n      console.error('File upload error:', error);\n      toast.error('Failed to upload files. Please try again.');\n    }\n  };\n  const downloadTableAsCSV = (table, index) => {\n    const headers = table.headers.join(',');\n    const rows = table.data.map(row => row.join(',')).join('\\n');\n    const csv = `${headers}\\n${rows}`;\n    const blob = new Blob([csv], {\n      type: 'text/csv'\n    });\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `table_${index + 1}_${currentSession}.csv`;\n    a.click();\n    window.URL.revokeObjectURL(url);\n  };\n  const downloadPlot = () => {\n    if (currentPlot && currentPlot.image) {\n      const link = document.createElement('a');\n      link.href = `data:image/png;base64,${currentPlot.image}`;\n      link.download = `plot_${currentSession}_${Date.now()}.png`;\n      link.click();\n    }\n  };\n  const currentSessionMessages = sessions[currentSession] || [];\n  return /*#__PURE__*/_jsxDEV(ChatContainer, {\n    children: [/*#__PURE__*/_jsxDEV(FileUploadSection, {\n      children: /*#__PURE__*/_jsxDEV(FileUpload, {\n        onFileUpload: handleFileUpload\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 373,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 372,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ChatSection, {\n      children: [/*#__PURE__*/_jsxDEV(ChatHeader, {\n        children: /*#__PURE__*/_jsxDEV(ChatTitle, {\n          children: \"\\uD83D\\uDCAC Ask a Question\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 378,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 377,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(MessagesContainer, {\n        children: [currentSessionMessages.length === 0 ? /*#__PURE__*/_jsxDEV(EmptyState, {\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Welcome to TONIC AI! \\uD83E\\uDD16\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 384,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Start a conversation by asking a question or upload some documents to get started.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 385,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 383,\n          columnNumber: 13\n        }, this) : currentSessionMessages.map((message, index) => /*#__PURE__*/_jsxDEV(ChatMessage, {\n          message: message\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 389,\n          columnNumber: 15\n        }, this)), isLoading && /*#__PURE__*/_jsxDEV(LoadingContainer, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"spinner\",\n            style: {\n              width: '32px',\n              height: '32px'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 395,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Generating response...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 396,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 394,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: messagesEndRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 400,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 381,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(InputSection, {\n        children: /*#__PURE__*/_jsxDEV(InputForm, {\n          onSubmit: handleSubmit,\n          children: [/*#__PURE__*/_jsxDEV(TextArea, {\n            value: userInput,\n            onChange: e => setUserInput(e.target.value),\n            placeholder: \"Ask me anything about your uploaded documents or any general question...\",\n            disabled: isLoading\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 405,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(SendButton, {\n            type: \"submit\",\n            disabled: isLoading || !userInput.trim(),\n            children: [isLoading ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"spinner\",\n              style: {\n                width: '20px',\n                height: '20px'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 413,\n              columnNumber: 17\n            }, this) : /*#__PURE__*/_jsxDEV(Send, {\n              size: 20\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 415,\n              columnNumber: 17\n            }, this), \"Send\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 411,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 404,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 403,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 376,\n      columnNumber: 7\n    }, this), currentPlot && /*#__PURE__*/_jsxDEV(PlotSection, {\n      children: [/*#__PURE__*/_jsxDEV(ResponseHeader, {\n        children: [/*#__PURE__*/_jsxDEV(BarChart3, {\n          size: 20\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 426,\n          columnNumber: 13\n        }, this), \"Generated Visualization\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 425,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          textAlign: 'center',\n          padding: '20px'\n        },\n        children: [currentPlot.image && /*#__PURE__*/_jsxDEV(\"img\", {\n          src: `data:image/png;base64,${currentPlot.image}`,\n          alt: \"Generated Plot\",\n          style: {\n            maxWidth: '100%',\n            height: 'auto',\n            marginBottom: '15px',\n            borderRadius: '8px'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 431,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(DownloadButton, {\n          onClick: downloadPlot,\n          children: [/*#__PURE__*/_jsxDEV(Download, {\n            size: 16\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 438,\n            columnNumber: 15\n          }, this), \"Download Plot\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 437,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 429,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 424,\n      columnNumber: 9\n    }, this), currentTables.length > 0 && /*#__PURE__*/_jsxDEV(TableSection, {\n      children: currentTables.map((table, index) => /*#__PURE__*/_jsxDEV(TableContainer, {\n        children: [/*#__PURE__*/_jsxDEV(TableHeader, {\n          children: [/*#__PURE__*/_jsxDEV(TableTitle, {\n            children: [\"\\uD83D\\uDCCA Table \", index + 1]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 450,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(DownloadButton, {\n            onClick: () => downloadTableAsCSV(table, index),\n            children: [/*#__PURE__*/_jsxDEV(Download, {\n              size: 16\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 452,\n              columnNumber: 19\n            }, this), \"Download CSV\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 451,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 449,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(Table, {\n          children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n            children: /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: table.headers.map((header, i) => /*#__PURE__*/_jsxDEV(Th, {\n                children: header\n              }, i, false, {\n                fileName: _jsxFileName,\n                lineNumber: 460,\n                columnNumber: 23\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 458,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 457,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n            children: table.data.map((row, i) => /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: row.map((cell, j) => /*#__PURE__*/_jsxDEV(Td, {\n                children: cell\n              }, j, false, {\n                fileName: _jsxFileName,\n                lineNumber: 468,\n                columnNumber: 25\n              }, this))\n            }, i, false, {\n              fileName: _jsxFileName,\n              lineNumber: 466,\n              columnNumber: 21\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 464,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 456,\n          columnNumber: 15\n        }, this)]\n      }, index, true, {\n        fileName: _jsxFileName,\n        lineNumber: 448,\n        columnNumber: 13\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 446,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 371,\n    columnNumber: 5\n  }, this);\n}\n_s(ChatInterface, \"WFCr7bt79wqzvbap6KOhLvlgwP8=\");\n_c21 = ChatInterface;\nexport default ChatInterface;\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8, _c9, _c0, _c1, _c10, _c11, _c12, _c13, _c14, _c15, _c16, _c17, _c18, _c19, _c20, _c21;\n$RefreshReg$(_c, \"ChatContainer\");\n$RefreshReg$(_c2, \"FileUploadSection\");\n$RefreshReg$(_c3, \"ChatSection\");\n$RefreshReg$(_c4, \"ChatHeader\");\n$RefreshReg$(_c5, \"ChatTitle\");\n$RefreshReg$(_c6, \"MessagesContainer\");\n$RefreshReg$(_c7, \"InputSection\");\n$RefreshReg$(_c8, \"InputForm\");\n$RefreshReg$(_c9, \"TextArea\");\n$RefreshReg$(_c0, \"SendButton\");\n$RefreshReg$(_c1, \"ResponseHeader\");\n$RefreshReg$(_c10, \"PlotSection\");\n$RefreshReg$(_c11, \"TableSection\");\n$RefreshReg$(_c12, \"TableContainer\");\n$RefreshReg$(_c13, \"TableHeader\");\n$RefreshReg$(_c14, \"TableTitle\");\n$RefreshReg$(_c15, \"DownloadButton\");\n$RefreshReg$(_c16, \"Table\");\n$RefreshReg$(_c17, \"Th\");\n$RefreshReg$(_c18, \"Td\");\n$RefreshReg$(_c19, \"EmptyState\");\n$RefreshReg$(_c20, \"LoadingContainer\");\n$RefreshReg$(_c21, \"ChatInterface\");","map":{"version":3,"names":["React","useState","useRef","useEffect","FileUpload","ChatMessage","Send","Download","BarChart3","styled","toast","fileAPI","chatAPI","jsxDEV","_jsxDEV","ChatContainer","div","_c","FileUploadSection","_c2","ChatSection","_c3","ChatHeader","_c4","ChatTitle","h3","_c5","MessagesContainer","_c6","InputSection","_c7","InputForm","form","_c8","TextArea","textarea","_c9","SendButton","button","_c0","ResponseSection","ResponseHeader","_c1","PlotSection","_c10","TableSection","_c11","TableContainer","_c12","TableHeader","_c13","TableTitle","h4","_c14","DownloadButton","_c15","Table","table","_c16","Th","th","_c17","Td","td","_c18","EmptyState","_c19","LoadingContainer","_c20","ChatInterface","currentSession","sessions","setSessions","_s","userInput","setUserInput","isLoading","setIsLoading","knowledgeBase","setKnowledgeBase","currentResponse","setCurrentResponse","currentPlot","setCurrentPlot","currentTables","setCurrentTables","messagesEndRef","scrollToBottom","_messagesEndRef$curre","current","scrollIntoView","behavior","handleSubmit","e","preventDefault","trim","question","newMessage","q","a","timestamp","Date","toLocaleString","type","prev","response","sendMessage","success","aiMessage","tables","plot","map","msg","index","length","error","console","handleFileUpload","files","upload","knowledge_base","message","downloadTableAsCSV","headers","join","rows","data","row","csv","blob","Blob","url","window","URL","createObjectURL","document","createElement","href","download","click","revokeObjectURL","downloadPlot","image","link","now","currentSessionMessages","children","onFileUpload","fileName","_jsxFileName","lineNumber","columnNumber","className","style","width","height","ref","onSubmit","value","onChange","target","placeholder","disabled","size","textAlign","padding","src","alt","maxWidth","marginBottom","borderRadius","onClick","header","i","cell","j","_c21","$RefreshReg$"],"sources":["/home/shubham/Documents/Personal/my-project/react-app/src/components/ChatInterface.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport FileUpload from './FileUpload';\nimport ChatMessage from './ChatMessage';\nimport { Send, Download, BarChart3 } from 'lucide-react';\nimport styled from 'styled-components';\nimport toast from 'react-hot-toast';\nimport { fileAPI, chatAPI } from '../services/api';\n\nconst ChatContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: calc(100vh - 140px);\n  max-width: 1200px;\n  margin: 0 auto;\n`;\n\nconst FileUploadSection = styled.div`\n  margin-bottom: 20px;\n  background: white;\n  border-radius: 12px;\n  padding: 20px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n  border: 1px solid #e2e8f0;\n`;\n\nconst ChatSection = styled.div`\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  overflow: hidden;\n  border: 1px solid #e2e8f0;\n`;\n\nconst ChatHeader = styled.div`\n  padding: 20px;\n  border-bottom: 1px solid #e2e8f0;\n  background: #f8f9fa;\n`;\n\nconst ChatTitle = styled.h3`\n  color: #2d3748;\n  margin: 0;\n  font-size: 1.2rem;\n  font-weight: 600;\n`;\n\nconst MessagesContainer = styled.div`\n  flex: 1;\n  overflow-y: auto;\n  padding: 20px;\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n  background: #f7fafc;\n`;\n\nconst InputSection = styled.div`\n  padding: 20px;\n  border-top: 1px solid #e2e8f0;\n  background: #f8f9fa;\n`;\n\nconst InputForm = styled.form`\n  display: flex;\n  gap: 12px;\n  align-items: flex-end;\n`;\n\nconst TextArea = styled.textarea`\n  flex: 1;\n  padding: 16px;\n  border: 1px solid #e2e8f0;\n  border-radius: 12px;\n  font-size: 16px;\n  font-family: inherit;\n  resize: vertical;\n  min-height: 60px;\n  max-height: 200px;\n  background: white;\n  transition: all 0.2s ease;\n  \n  &:focus {\n    outline: none;\n    border-color: #FF6B35;\n    box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);\n  }\n  \n  &::placeholder {\n    color: #a0aec0;\n  }\n`;\n\nconst SendButton = styled.button`\n  padding: 16px 24px;\n  background: linear-gradient(135deg, #FF6B35 0%, #e53e3e 100%);\n  color: white;\n  border: none;\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-weight: 600;\n  font-size: 14px;\n  \n  &:hover {\n    transform: translateY(-1px);\n    box-shadow: 0 10px 25px rgba(255, 107, 53, 0.3);\n  }\n  \n  &:disabled {\n    opacity: 0.6;\n    cursor: not-allowed;\n    transform: none;\n  }\n`;\n\nconst ResponseSection = styled.div`\n  margin-top: 20px;\n  padding: 20px;\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  border: 1px solid #e2e8f0;\n`;\n\nconst ResponseHeader = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  margin-bottom: 15px;\n  color: #2d3748;\n  font-weight: 600;\n`;\n\nconst PlotSection = styled.div`\n  margin-top: 20px;\n  padding: 20px;\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  border: 1px solid #e2e8f0;\n`;\n\nconst TableSection = styled.div`\n  margin-top: 20px;\n`;\n\nconst TableContainer = styled.div`\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  overflow: hidden;\n  margin-bottom: 15px;\n  border: 1px solid #e2e8f0;\n`;\n\nconst TableHeader = styled.div`\n  padding: 16px 20px;\n  background: #f8f9fa;\n  border-bottom: 1px solid #e2e8f0;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n`;\n\nconst TableTitle = styled.h4`\n  color: #2d3748;\n  margin: 0;\n  font-weight: 600;\n`;\n\nconst DownloadButton = styled.button`\n  padding: 8px 16px;\n  background: #FF6B35;\n  color: white;\n  border: none;\n  border-radius: 8px;\n  cursor: pointer;\n  font-size: 0.9rem;\n  display: flex;\n  align-items: center;\n  gap: 5px;\n  font-weight: 500;\n  transition: all 0.2s ease;\n  \n  &:hover {\n    background: #e53e3e;\n    transform: translateY(-1px);\n  }\n`;\n\nconst Table = styled.table`\n  width: 100%;\n  border-collapse: collapse;\n`;\n\nconst Th = styled.th`\n  padding: 12px 16px;\n  text-align: left;\n  background: #f8f9fa;\n  border-bottom: 1px solid #e2e8f0;\n  font-weight: 600;\n  color: #2d3748;\n`;\n\nconst Td = styled.td`\n  padding: 12px 16px;\n  border-bottom: 1px solid #e2e8f0;\n  color: #4a5568;\n`;\n\nconst EmptyState = styled.div`\n  text-align: center;\n  padding: 60px 20px;\n  color: #718096;\n  \n  h3 {\n    margin-bottom: 12px;\n    color: #4a5568;\n    font-weight: 600;\n  }\n  \n  p {\n    margin-bottom: 20px;\n    font-size: 16px;\n  }\n`;\n\nconst LoadingContainer = styled.div`\n  text-align: center;\n  padding: 40px 20px;\n  color: #718096;\n  \n  .spinner {\n    margin: 0 auto 16px auto;\n  }\n  \n  p {\n    font-size: 16px;\n    margin: 0;\n  }\n`;\n\nfunction ChatInterface({ currentSession, sessions, setSessions }) {\n  const [userInput, setUserInput] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [knowledgeBase, setKnowledgeBase] = useState('');\n  const [currentResponse, setCurrentResponse] = useState('');\n  const [currentPlot, setCurrentPlot] = useState(null);\n  const [currentTables, setCurrentTables] = useState([]);\n  const messagesEndRef = useRef(null);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [sessions[currentSession]]);\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    if (!userInput.trim() || isLoading) return;\n\n    const question = userInput.trim();\n    setUserInput('');\n    setIsLoading(true);\n\n    // Add user message to session\n    const newMessage = {\n      q: question,\n      a: '',\n      timestamp: new Date().toLocaleString(),\n      type: 'user'\n    };\n\n    setSessions(prev => ({\n      ...prev,\n      [currentSession]: [...prev[currentSession], newMessage]\n    }));\n\n    try {\n      // Get AI response from backend\n      const response = await chatAPI.sendMessage(\n        question, \n        knowledgeBase, \n        sessions[currentSession], \n        currentSession\n      );\n      \n      if (response.success) {\n        // Add AI response to session\n        const aiMessage = {\n          q: question,\n          a: response.response,\n          timestamp: response.timestamp,\n          type: 'ai',\n          tables: response.tables || [],\n          plot: response.plot\n        };\n\n        setSessions(prev => ({\n          ...prev,\n          [currentSession]: prev[currentSession].map((msg, index) => \n            index === prev[currentSession].length - 1 ? aiMessage : msg\n          )\n        }));\n\n        setCurrentResponse(response.response);\n        setCurrentTables(response.tables || []);\n        setCurrentPlot(response.plot);\n\n      } else {\n        toast.error('Failed to get response from AI');\n      }\n\n    } catch (error) {\n      toast.error('Failed to get response. Please try again.');\n      console.error('Error:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleFileUpload = async (files) => {\n    try {\n      const response = await fileAPI.upload(files);\n      if (response.success) {\n        setKnowledgeBase(response.knowledge_base);\n        toast.success(response.message);\n      } else {\n        toast.error('Failed to process files');\n      }\n    } catch (error) {\n      console.error('File upload error:', error);\n      toast.error('Failed to upload files. Please try again.');\n    }\n  };\n\n  const downloadTableAsCSV = (table, index) => {\n    const headers = table.headers.join(',');\n    const rows = table.data.map(row => row.join(',')).join('\\n');\n    const csv = `${headers}\\n${rows}`;\n    \n    const blob = new Blob([csv], { type: 'text/csv' });\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `table_${index + 1}_${currentSession}.csv`;\n    a.click();\n    window.URL.revokeObjectURL(url);\n  };\n\n  const downloadPlot = () => {\n    if (currentPlot && currentPlot.image) {\n      const link = document.createElement('a');\n      link.href = `data:image/png;base64,${currentPlot.image}`;\n      link.download = `plot_${currentSession}_${Date.now()}.png`;\n      link.click();\n    }\n  };\n\n  const currentSessionMessages = sessions[currentSession] || [];\n\n  return (\n    <ChatContainer>\n      <FileUploadSection>\n        <FileUpload onFileUpload={handleFileUpload} />\n      </FileUploadSection>\n\n      <ChatSection>\n        <ChatHeader>\n          <ChatTitle>💬 Ask a Question</ChatTitle>\n        </ChatHeader>\n\n        <MessagesContainer>\n          {currentSessionMessages.length === 0 ? (\n            <EmptyState>\n              <h3>Welcome to TONIC AI! 🤖</h3>\n              <p>Start a conversation by asking a question or upload some documents to get started.</p>\n            </EmptyState>\n          ) : (\n            currentSessionMessages.map((message, index) => (\n              <ChatMessage key={index} message={message} />\n            ))\n          )}\n          \n          {isLoading && (\n            <LoadingContainer>\n              <div className=\"spinner\" style={{ width: '32px', height: '32px' }}></div>\n              <p>Generating response...</p>\n            </LoadingContainer>\n          )}\n          \n          <div ref={messagesEndRef} />\n        </MessagesContainer>\n\n        <InputSection>\n          <InputForm onSubmit={handleSubmit}>\n            <TextArea\n              value={userInput}\n              onChange={(e) => setUserInput(e.target.value)}\n              placeholder=\"Ask me anything about your uploaded documents or any general question...\"\n              disabled={isLoading}\n            />\n            <SendButton type=\"submit\" disabled={isLoading || !userInput.trim()}>\n              {isLoading ? (\n                <div className=\"spinner\" style={{ width: '20px', height: '20px' }}></div>\n              ) : (\n                <Send size={20} />\n              )}\n              Send\n            </SendButton>\n          </InputForm>\n        </InputSection>\n      </ChatSection>\n\n      {currentPlot && (\n        <PlotSection>\n          <ResponseHeader>\n            <BarChart3 size={20} />\n            Generated Visualization\n          </ResponseHeader>\n          <div style={{ textAlign: 'center', padding: '20px' }}>\n            {currentPlot.image && (\n              <img \n                src={`data:image/png;base64,${currentPlot.image}`} \n                alt=\"Generated Plot\" \n                style={{ maxWidth: '100%', height: 'auto', marginBottom: '15px', borderRadius: '8px' }}\n              />\n            )}\n            <DownloadButton onClick={downloadPlot}>\n              <Download size={16} />\n              Download Plot\n            </DownloadButton>\n          </div>\n        </PlotSection>\n      )}\n\n      {currentTables.length > 0 && (\n        <TableSection>\n          {currentTables.map((table, index) => (\n            <TableContainer key={index}>\n              <TableHeader>\n                <TableTitle>📊 Table {index + 1}</TableTitle>\n                <DownloadButton onClick={() => downloadTableAsCSV(table, index)}>\n                  <Download size={16} />\n                  Download CSV\n                </DownloadButton>\n              </TableHeader>\n              <Table>\n                <thead>\n                  <tr>\n                    {table.headers.map((header, i) => (\n                      <Th key={i}>{header}</Th>\n                    ))}\n                  </tr>\n                </thead>\n                <tbody>\n                  {table.data.map((row, i) => (\n                    <tr key={i}>\n                      {row.map((cell, j) => (\n                        <Td key={j}>{cell}</Td>\n                      ))}\n                    </tr>\n                  ))}\n                </tbody>\n              </Table>\n            </TableContainer>\n          ))}\n        </TableSection>\n      )}\n    </ChatContainer>\n  );\n}\n\nexport default ChatInterface;\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,MAAM,EAAEC,SAAS,QAAQ,OAAO;AAC1D,OAAOC,UAAU,MAAM,cAAc;AACrC,OAAOC,WAAW,MAAM,eAAe;AACvC,SAASC,IAAI,EAAEC,QAAQ,EAAEC,SAAS,QAAQ,cAAc;AACxD,OAAOC,MAAM,MAAM,mBAAmB;AACtC,OAAOC,KAAK,MAAM,iBAAiB;AACnC,SAASC,OAAO,EAAEC,OAAO,QAAQ,iBAAiB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEnD,MAAMC,aAAa,GAAGN,MAAM,CAACO,GAAG;AAChC;AACA;AACA;AACA;AACA;AACA,CAAC;AAACC,EAAA,GANIF,aAAa;AAQnB,MAAMG,iBAAiB,GAAGT,MAAM,CAACO,GAAG;AACpC;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AAACG,GAAA,GAPID,iBAAiB;AASvB,MAAME,WAAW,GAAGX,MAAM,CAACO,GAAG;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AAACK,GAAA,GATID,WAAW;AAWjB,MAAME,UAAU,GAAGb,MAAM,CAACO,GAAG;AAC7B;AACA;AACA;AACA,CAAC;AAACO,GAAA,GAJID,UAAU;AAMhB,MAAME,SAAS,GAAGf,MAAM,CAACgB,EAAE;AAC3B;AACA;AACA;AACA;AACA,CAAC;AAACC,GAAA,GALIF,SAAS;AAOf,MAAMG,iBAAiB,GAAGlB,MAAM,CAACO,GAAG;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AAACY,GAAA,GARID,iBAAiB;AAUvB,MAAME,YAAY,GAAGpB,MAAM,CAACO,GAAG;AAC/B;AACA;AACA;AACA,CAAC;AAACc,GAAA,GAJID,YAAY;AAMlB,MAAME,SAAS,GAAGtB,MAAM,CAACuB,IAAI;AAC7B;AACA;AACA;AACA,CAAC;AAACC,GAAA,GAJIF,SAAS;AAMf,MAAMG,QAAQ,GAAGzB,MAAM,CAAC0B,QAAQ;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AAACC,GAAA,GAtBIF,QAAQ;AAwBd,MAAMG,UAAU,GAAG5B,MAAM,CAAC6B,MAAM;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AAACC,GAAA,GAxBIF,UAAU;AA0BhB,MAAMG,eAAe,GAAG/B,MAAM,CAACO,GAAG;AAClC;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AAED,MAAMyB,cAAc,GAAGhC,MAAM,CAACO,GAAG;AACjC;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AAAC0B,GAAA,GAPID,cAAc;AASpB,MAAME,WAAW,GAAGlC,MAAM,CAACO,GAAG;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AAAC4B,IAAA,GAPID,WAAW;AASjB,MAAME,YAAY,GAAGpC,MAAM,CAACO,GAAG;AAC/B;AACA,CAAC;AAAC8B,IAAA,GAFID,YAAY;AAIlB,MAAME,cAAc,GAAGtC,MAAM,CAACO,GAAG;AACjC;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AAACgC,IAAA,GAPID,cAAc;AASpB,MAAME,WAAW,GAAGxC,MAAM,CAACO,GAAG;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AAACkC,IAAA,GAPID,WAAW;AASjB,MAAME,UAAU,GAAG1C,MAAM,CAAC2C,EAAE;AAC5B;AACA;AACA;AACA,CAAC;AAACC,IAAA,GAJIF,UAAU;AAMhB,MAAMG,cAAc,GAAG7C,MAAM,CAAC6B,MAAM;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AAACiB,IAAA,GAlBID,cAAc;AAoBpB,MAAME,KAAK,GAAG/C,MAAM,CAACgD,KAAK;AAC1B;AACA;AACA,CAAC;AAACC,IAAA,GAHIF,KAAK;AAKX,MAAMG,EAAE,GAAGlD,MAAM,CAACmD,EAAE;AACpB;A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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}